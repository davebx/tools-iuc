<tool id="plasmidspades" name="plasmidspades" version="1.1">
    <description>genome assembler for plasmids</description>
    <requirements>
        <requirement type="package" version="3.9.0">spades</requirement>
    </requirements>
    <command>
    <![CDATA[
    spades.py -o . --disable-gzip-output --plasmid $onlyassembler $careful -t \${GALAXY_SLOTS:-16} -k "$kmers"
    #if $cov.state == "auto":
    --cov-cutoff 'auto'
    #elif $cov.state == "value":
    --cov-cutoff '$cov.cutoff'
    #end if
    $iontorrent
    ## Sequence files
    #if str( $lib_type ) == "paired_end":
        #set prefix = 'pe'
    #elif str( $lib_type ) == "mate_paired":
        #set prefix = 'mp'
    #elif str( $lib_type ) == "nxmate_paired":
        #set prefix = 'nxmate'
    #else:
        #set prefix = 'hqmp'
    #end if
    #set num=1
    --$prefix$num-$orientation
    #for $num, $file in enumerate( $files, start=1 ):
        #if $file.file_type.type == "separate"
            --$prefix$num-1 fastq:$file.file_type.fwd_reads
            --$prefix$num-2 fastq:$file.file_type.rev_reads
        #elif $file.file_type.type == "interleaved"
            --$prefix$num-12 fastq:$file.file_type.interleaved_reads
        #elif $file.file_type.type == "unpaired"
            --$prefix$num-s fastq:$file.file_type.unpaired_reads
        #elif $file.file_type.type == "paired-collection"
            --$prefix$num-1 fastq:$file.file_type.fastq_collection.forward
            --$prefix$num-2 fastq:$file.file_type.fastq_collection.reverse
        #end if
    #end for
    #for $read in $pacbio_reads:
        #if $read:
            --pacbio fastq:$read
        #end if
    #end for
    #for $read in $nanopore_reads:
        #if $read:
            --nanopore fastq:$read
        #end if
    #end for
    #for $read in $sanger_reads:
        #if $read:
            --sanger $read.extension:$read
        #end if
    #end for
    #for $contig in $trusted_contigs:
        #if $contig:
            --trusted-contigs $contig.extension:$contig
        #end if
    #end for
    #for $contig in $untrusted_contigs:
        #if $contig:
            --untrusted-contigs $contig.extension:$contig
        #end if
    #end for
    ]]>
    </command>
    <inputs>
        <param argument="--only-assembler" checked="False" falsevalue="" label="Run only assembly? (without read error correction)" name="onlyassembler" truevalue="--only-assembler" type="boolean" />
        <param argument="--careful" checked="True" falsevalue="" help="Tries to reduce number of mismatches and short indels. Also runs MismatchCorrector &#8211; a post processing tool, which uses BWA tool (comes with SPAdes)." label="Careful correction?" name="careful" truevalue="--careful" type="boolean" />
        <param help="Comma-separated list of k-mer sizes to be used (all values must be odd, less than 128, listed in ascending order, and smaller than the read length). The default value is 21,33,55." label="K-mers to use, separated by commas" name="kmers" type="text" value="21,33,55" />
        <conditional name="cov">
            <param label="Coverage Cutoff" name="state" type="select">
                <option value="off">Off</option>
                <option value="value">User Specific</option>
                <option value="auto">Auto</option>
            </param>
            <when value="off" />
            <when value="value">
                <param help="coverage cutoff value (a positive float number, or 'auto', or 'off') [default: 'off']" label="Coverage cutoff value" name="cutoff" type="float" value="" />
            </when>
            <when value="auto" />
        </conditional>
        <param argument="--iontorrent" checked="False" falsevalue="" label="Libraries are IonTorrent reads?" name="iontorrent" truevalue="--iontorrent" type="boolean" />
        <param label="Library type" name="lib_type" type="select">
            <option value="paired_end">Paired-end / Single reads</option>
            <option value="mate_paired">Mate pairs</option>
            <option value="high_mate_paired">High Quality Mate pairs</option>
            <option value="nxmate_paired">Lucigen NxMate pairs</option>
        </param>
        <param label="Orientation" name="orientation" type="select">
            <option selected="true" value="fr"><![CDATA[-> <- (fr)]]></option>
            <option value="rf"><![CDATA[<- -> (rf)]]></option>
            <option value="ff"><![CDATA[-> -> (ff)]]></option>
        </param>
        <repeat min="1" name="files" title="Files">
            <conditional name="file_type">
                <param label="Select file format" name="type" type="select">
                    <option value="separate">Separate input files</option>
                    <option value="interleaved">Interleaved files</option>
                    <option value="unpaired">Unpaired/Single reads</option>
                    <option value="paired-collection">Paired List Collection</option>
                </param>
                <when value="separate">
                    <param format="fastq" help="FASTQ format" label="Forward reads" name="fwd_reads" type="data" />
                    <param format="fastq" help="FASTQ format" label="Reverse reads" name="rev_reads" type="data" />
                </when>
                <when value="interleaved">
                    <param format="fastq" help="FASTQ format" label="Interleaved paired reads" name="interleaved_reads" type="data" />
                </when>
                <when value="unpaired">
                    <param format="fastq" help="FASTQ format" label="Unpaired reads" name="unpaired_reads" type="data" />
                </when>
                <when value="paired-collection">
                    <param collection_type="paired" format="fastq" help="FASTQ format" label="Paired-end reads collection" name="fastq_collection" type="data_collection" />
                </when>
            </conditional>
        </repeat>
        <param optional="true" format="fastq" label="PacBio CLR reads" multiple="true" name="pacbio_reads" type="data" />
        <param optional="true" format="fastq" label="Nanopore reads" multiple="true" name="nanopore_reads" type="data" />
        <param optional="true" format="fasta,fastq" label="Sanger reads" multiple="true" name="sanger_reads" type="data" />
        <param optional="true" format="fasta,fastq" label="Trusted contigs" multiple="true" name="trusted_contigs" type="data" />
        <param optional="true" format="fasta,fastq" label="Untrusted contigs" multiple="true" name="untrusted_contigs" type="data" />
    </inputs>
    <outputs>
        <data format="fasta" label="SPAdes contigs (fasta)" name="out_contigs" />
        <data format="tabular" label="SPAdes contig stats" name="out_contig_stats" />
        <data format="fasta" label="SPAdes scaffolds (fasta)" name="out_scaffolds" />
        <data format="tabular" label="SPAdes scaffold stats" name="out_scaffold_stats" />
        <data format="txt" label="SPAdes log" name="out_log" />
    </outputs>
<!--
    <tests>
        <test>
            <param name="sc" value="false" />
            <param name="careful" value="false" />
            <param name="kmers" value="33,55" />
            <param name="lib_type" value="paired_end" />
            <param ftype="fastq" name="fwd_reads" value="ecoli_1K_1.fq" />
            <param ftype="fastq" name="rev_reads" value="ecoli_1K_2.fq" />
            <output compare="re_match" file="reference_1K.fa" ftype="fasta" lines_diff="1" name="out_contigs" />
        </test>
    </tests>
 -->
    <help>
<![CDATA[
**What it does**

SPAdes - St. Petersburg genome assembler - is intended for both standard isolates and single-cell MDA bacteria assemblies. See http://bioinf.spbau.ru/en/spades for more details on SPAdes.
]]>
  </help>
    <citations>
        <citation type="doi">10.1089/cmb.2012.0021</citation>
    </citations>
</tool>
