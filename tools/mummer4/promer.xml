<tool id="promer" name="Promer" version="0.1.0">
    <requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        #set $query=""+"".join(str($query_sequence).split(','))+""
        promer
            $anchoring
            -b $breaklen
            -c $mincluster
            -d $diagfactor
            $noextend
            -g $maxgap
            -l $minmatch
            -m $masklen
            $nooptimize
            -x $matrix
            '$reference_sequence' '$query'
        ]]>
    </command>
    <inputs>
        <param name="reference_sequence" type="data" format="fasta" label="Reference Sequence" help="FastA or multi-FastA" />
        <param name="query_sequence" type="data" multiple="True" format="fasta" label="Query Sequence" help="FastA or multi-FastA" />
        <param name="anchoring" type="select" label="Match Anchoring Strategy">
            <option value="--mumreference">Default</option>
            <option value="--mum">Unique matches in both reference and query(--mum)</option>
            <option value="--maxmatch">Use all matches regardless of uniqueness(--maxmatch)</option>
        </param>
        <param name="breaklen" type="integer" argument="-b" value="60" label="Break Length" help="Set the distance an alignment extension will attempt to extend poor scoring regions before giving up" />
        <param name="mincluster" type="integer" argument="-c" value="20" label="Minumum Cluster Length" help="Sets the minimum length of a cluster of matches" />
        <param name="diagfactor" type="float" argument="-d" value="0.11" label="Maximum Diagonal Difference as Fraction" help="Set the maximum diagonal difference between two adjacent anchors in a cluster as a differential fraction of the gap length" />
        <param name="noextend" type="boolean" argument="--extend" truevalue="--extend" falsevalue="--noextend" checked="true" label="Extend Clusters" help="Toggle cluster extension" />
        <param name="maxgap" type="integer" argument="-g" value="30" label="Maximum Gap Distance" help="Set the maximum gap between two adjacent matches in a cluster" />
        <param name="minmatch" type="integer" argument="-l" value="6" label="Minimum Match Length" help="Set the minimum length of a single exact match" />
        <param name="masklen" type="integer" argument="-m" value="8" label="Maximum Masking Length" help="Set the maximum bookend masking lenth, measured in amino acids" />
        <param name="nooptimize" type="boolean" argument="--optimize" truevalue="--optimize" falsevalue="--nooptimize" checked="true" label="Alignment Score Optimization" help="Toggle alignment score optimization, i.e. if an alignment extension reaches the end of a sequence, it will backtrack to optimize the alignment score instead of terminating the alignment at the end of the sequence" />
        <param name="matrix" type="select" label="Alignment Matrix" help="Set the alignment matrix number to BLOSUM 45, BLOSUM 62 (defualt), or BLOSUM 80" >
            <option value="2">BLOSUM 62</option>
            <option value="1">BLOSUM 45</option>
            <option value="3">BLOSUM 80</option>
        </param>
    </inputs> 
    <outputs>
        <data name="output" format="txt" from_work_dir="out.delta" label="Promer" />
    </outputs>
    <tests>
        <test>
            <param name="matrix" value="2" />
            <param name="reference_sequence" ftype="fasta" value="human_aqp3.fasta"/>
            <param name="query_sequence" ftype="fasta" value="mouse_aqp3.fasta"/>
            <output name="output" ftype="txt" compare="diff" lines_diff="2"  value="promer.txt" />
        </test>
    </tests>
    <help>
        promer is for the protein level, all-vs-all comparison of nucleotide sequences contained in multi-FastA data files. The nucleotide input files are translated in all 6 reading frames and then aligned to one another via the same methods as nucmer. It is best used for highly divergent sequences that may have moderate to high similarity on the protein level. Common use cases are: identifying syntenic regions between highly divergent genomes, comparative genome annotation i.e. using an already annotated genome to help in the annotation of a newly sequenced genome, and the general comparison of two fairly divergent genomes that have large rearrangements and may only be similar on the protein level. 

        All output coordinates reference the forward strand of the involved sequence, regardless of the match direction, and are measured in nucleotides with the exception of the delta integers which are measured in amino acids (1 delta int = 3 nucleotides). Also, promer now uses only matches that are unique in the reference sequence by default, use the '--mum' or '--maxmatch' options to change this behavior.
        
        The output file can be parsed by any of the show-* programs.

    </help>
    <citations>
        <citation type="bibtex">
            @misc{githubmummer,
            author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
            year = {2012},
            title = {mummer4},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/mummer4/mummer},
        }</citation>
	</citations>
</tool>