<tool id="dnadiff" name="DNAdiff" version="0.1.0">
    <requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        dnadiff
        #if str($input_selector.input_type) == 'sequence'
            #set $query = ""+"".join(str($input_selector.query_sequence).split(','))+""
            '$input_selector.reference_sequence' '$query'
        #else if str($input_selector.input_type) == 'delta'
            -d '$input_selector.delta_data'
        #end if
        ]]>  
    </command>
    <inputs>
        <conditional name="input_selector">
            <param name="input_type" type="select" label="Choose input type">
                <option value="sequence">Sequence data</option>
                <option value="delta">Delta file from nucmer</option>
            </param>
            <when value="sequence">
                <param name="reference_sequence" type="data" format="fasta" label="Reference Sequence" help="FastA or multi-FastA" />
                <param name="query_sequence" type="data" format="fasta" multiple="True" label="Query Sequence(s)" help="FastA or multi-FastA" />
            </when>
            <when value="delta">
                <param name="delta_data" type="data" format="txt" label="Alignment file from nucmer or promer" />
            </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="report" format="txt" from_work_dir="out.report" label="DNAdiff_report" />
        <data name="delta" format="txt" from_work_dir="out.delta" label="DNAdiff_delta">
            <filter>input_selector['input_type'] == 'sequence'</filter>
        </data>
        <data name="1delta" format="txt" from_work_dir="out.1delta" label="DNAdiff_1delta" />
        <data name="mdelta" format="txt" from_work_dir="out.mdelta" label="DNAdiff_mdelta" />
        <data name="1coords" format="txt" from_work_dir="out.1coords" label="DNAdiff_1coords" />
        <data name="mcoords" format="txt" from_work_dir="out.mcoords" label="DNAdiff_mcoords" />
        <data name="snps" format="txt" from_work_dir="out.snps" label="DNAdiff_snps" />
        <data name="rdiff" format="txt" from_work_dir="out.rdiff" label="DNAdiff_rdiff" />
        <data name="qdiff" format="txt" from_work_dir="out.qdiff" label="DNAdiff_qdiff" />
    </outputs>
    <tests>
        <test>
            <param name="reference_sequence" ftype="fasta" value="human_aqp3.fasta" />
            <param name="query_sequence" ftype="fasta" value="mouse_aqp3.fasta"/>
            <param name="input_type" value="sequence" />
            <output name="report" ftype="txt" compare="diff" sort="true" lines_diff="2" value="report.txt"/>
            <output name="delta" ftype="txt" compare="diff" lines_diff="2" value="delta.txt"/>
            <output name="1delta" ftype="txt" compare="diff" lines_diff="2" value="1delta.txt"/>
            <output name="mdelta" ftype="txt" compare="diff" lines_diff="2" value="mdelta.txt"/>
            <output name="1coords" ftype="txt" compare="diff" value="1coords.txt"/>
            <output name="mcoords" ftype="txt" compare="diff" value="mcoords.txt"/>
            <output name="snps" ftype="txt" compare="diff" value="snps.txt"/>
            <output name="rdiff" ftype="txt" compare="diff" value="rdiff.txt"/>
            <output name="qdiff" ftype="txt" compare="diff" value="qdiff.txt"/>
        </test>
        <test>
            <param name="delta_data" ftype="txt" value="nucmer.txt" />
            <param name="input_type" value="delta" />
            <output name="report" ftype="txt" compare="diff" sort="true" lines_diff="2" value="report.txt" />
            <output name="1delta" ftype="txt" compare="diff" value="1delta.txt"/>
            <output name="mdelta" ftype="txt" compare="diff" value="mdelta.txt"/>
            <output name="1coords" ftype="txt" compare="diff" value="1coords.txt"/>
            <output name="mcoords" ftype="txt" compare="diff" value="mcoords.txt"/>
            <output name="snps" ftype="txt" compare="diff" value="snps.txt"/>
            <output name="rdiff" ftype="txt" compare="diff" value="rdiff.txt"/>
            <output name="qdiff" ftype="txt" compare="diff" value="qdiff.txt"/>
        </test>
    </tests>
     <help><![CDATA[
This script is a wrapper around nucmer that builds an alignment using default parameters, and runs many of nucmer's helper scripts to process the output and report alignment statistics, SNPs, breakpoints, etc. It is designed for evaluating the sequence and structural similarity of two highly similar sequence sets. E.g. comparing two different assemblies of the same organism, or comparing two strains of the same species.

**Output files:**
    * report: Summary of alignments, differences and SNPs
    * delta: Standard nucmer alignment output
    * 1delta: 1-to-1 alignment from delta-filter -1
    * mdelta: M-to-M alignment from delta-filter -m
    * 1coords: 1-to-1 coordinates from show-coords -THrcl .1delta
    * mcoords: M-to-M coordinates from show-coords -THrcl .mdelta
    * snps: SNPs from show-snps -rlTHC .1delta
    * rdiff: Classified ref breakpoints from show-diff -rH .mdelta
    * qdiff: Classified qry breakpoints from show-diff -qH .mdelta
    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{githubmummer,
            author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
            year = {2012},
            title = {mummer4},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/mummer4/mummer},
        }</citation>
    </citations>
</tool>