<tool id="show-diff" name="Show-Diff" version="0.1.0">
    <requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        show-diff
            $amos
            $info
            '$delta' > '$output'
        ]]>
    </command>
    <inputs>
        <param name="delta" type="data" format="txt" label="Delta File" />
        <param name="amos" type="boolean" argument="-f" truevalue="-f" falsevalue="" label="Output diff information as AMOS features" />
        <param name="header" type="boolean" argument="-H" truevalue="-H" falsevalue="" label="Do not show header" />
        <param name="info" type="select" label="Show diff information for queries or references" >
            <option value="-r">References</option>
            <option value="-q">Queries</option>
        </param>
    </inputs>
    <outputs>
        <data name="output" format="txt" from_work_dir="show-diff.txt" label="show_diff" />
    </outputs>
    <tests>
        <test>
            <param name="delta" ftype="txt" value="nucmer.txt" />
            <output name="output" ftype="txt" compare="diff" value="show-diff.txt" />
        </test>
    </tests>
    <help><![CDATA[
This program classifies alignment breakpoints for the quantification of macroscopic differences between two genomes. It takes a standard, unfiltered delta file as input, determines the best mapping between the two sequence sets, and reports on the breaks in that mapping.

**Output:** Classified breakpoints are output one per line with the following types and column definitions. The first five columns of every row are seq ID, feature type, feature start, feature end, and feature length.

Feature Types:
    * **[GAP]** A gap between two mutually consistent ordered and oriented alignments. gap-length-R is the length of the alignment gap in the reference, gap-length-Q is the length of the alignment gap in the query, and gap-diff is the difference between the two gap lengths. If gap-diff is positive, sequence has been inserted in the reference. If gap-diff is negative, sequence has been deleted from the reference. If both gap-length-R and gap-length-Q are negative, the indel is tandem duplication copy difference.
    * **[DUP]** A duplicated sequence in the reference that occurs more times in the reference than in the query. The coordinate columns specify the bounds and length of the duplication. These features are often bookended by BRK features if there is unique sequence bounding the duplication.
    * **[BRK]** An insertion in the reference of unknown origin, that indicates no query sequence aligns to the sequence bounded by gap-start and gap-end. Often found around DUP elements or at the beginning or end of sequences.
    * **[JMP]** A relocation event, where the consistent ordering of alignments is disrupted. The coordinate columns specify the breakpoints of the relocation in the reference, and the gap-length between them. A negative gap-length indicates the relocation occurred around a repetitive sequence, and a positive length indicates unique sequence between the alignments.
    * **[INV]** The same as a relocation event, however both the ordering and orientation of the alignments is disrupted. Note that for JMP and INV, generally two features will be output, one for the beginning of the inverted region, and another for the end of the inverted region.
    * **[SEQ]** A translocation event that requires jumping to a new query sequence in order to continue aligning to the reference. If each input sequence is a chromosome, these features correspond to inter-chromosomal translocations.

The estimated number of features, take inversions for example, represents the number of breakpoints classified as bordering an inversion. Therefore, since there will be a breakpoint at both the beginning and the end of an inversion, the feature counts are roughly double the number of inversion events. In addition, all counts are estimates and do not represent the exact number of each evolutionary event.

Summing the fifth column (ignoring negative values) yeilds an estimate of the total inserted sequence in the reference. Summing the fifth column after removing DUP features yields an estimate of the total amount of unique (unaligned) sequence in the reference. Note that unaligned sequences are not counted, and could represent additional "unique" sequences. Use the dnadiff script if you must recover this information. Finally, the -q option switches references for queries, and uses the query coordinates for the analysis.
    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{githubmummer,
            author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
            year = {2012},
            title = {mummer4},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/mummer4/mummer},
        }</citation>
    </citations>
</tool>