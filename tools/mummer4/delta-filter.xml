<tool id="delta-filter" name="Delta-Filter" version="0.1.0">
    <requirements>
        <requirement type="package" version="4.0.0beta2">mummer4</requirement>
        <requirement type="package" version="1.12.14">sh</requirement>
        <requirement type="package" version="4.4">sed</requirement>
        <requirement type="package" version="4.2.1">gawk</requirement>
        <requirement type="package" version="3.2.6a">fig2dev</requirement>
        <requirement type="package" version="5.2.3">gnuplot</requirement>
        <requirement type="package" version="3.2.6a">xfig</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
        delta-filter
            $alignment
            -i '$min_identity'
            -l '$min_length'
            $overlap
            -u '$min_uniqueness'
            -o '$max_overlap'
            '$delta' > '$output'
        ]]>
    </command>
    <inputs>
        <param name="delta" type="data" format="txt" label="Match file from nucmer" />
        <param name="alignment" type="select" label="Alignment strategy" >
            <option value="-m">Use default [Many-to-many alignment allowing for rearrangements(-m)]</option>
            <option value="-1">1-to-1 alignment allowing for rearrangements(-1)</option>
            <option value="-g">1-to-1 global alignment not allowing rearrangements(-g)</option>
        </param>
        <param name="min_identity" type="float" argument="-i" value="0" min="0" max="100" label="Set the minimum alignment identity" />
        <param name="min_length" type="integer" argument="-l" value="0" label="Set the minimum alignment length" />
        <param name="overlap" type="select" label="Reference/Query Overlaps" help=" Maps each position of each query/reference to its best hit in the reference/query, allowing for reference/query overlaps" >
            <option value="-q">Reference overlaps(-q)</option>
            <option value="-r">Query overlaps(-r)</option>
        </param>
        <param name="min_uniqueness" type="float" argument="-u" value="0" min="0" max="100" label="Minimum Alignment Uniqueness" help="Set the minimum alignment uniqueness, i.e. percent of the alignment matching to unique reference AND query sequence" />
        <param name="max_overlap" type="float" argument="-o" value="100" min="0" max="100" label="Maximum Alignment Overlap" help="Set the maximum alignment overlap for overlap options as a percent of the alignment length" />
    </inputs>
    <outputs>
        <data name="output" format="txt" from_work_dir="delta-filter.txt" label="delta_filter"/>
    </outputs>
    <tests>
        <test>
            <param name="delta" ftype="txt" value="nucmer.txt" />
            <output name="output" ftype="txt" compare="diff" lines_diff="2" value="delta-filter.txt" />
        </test>
    </tests>
    <help><![CDATA[
        This program filters a delta alignment file produced by either nucmer or promer, leaving only the desired alignments which are output to stdout in the same delta format as the input. Its primary function is the LIS algorithm which calculates the longest increasing subset of alignments. This allows for the calculation of a global set of alignments (i.e. 1-to-1 and mutually consistent order) with the -g option or locally consistent with -1 or -m. Reference sequences can be mapped to query sequences with -r, or queries to references with -q. This allows the user to exclude chance and repeat induced alignments, leaving only the "best" alignments between the two data sets. Filtering can also be performed on length, identity, and uniquenes.

        For multiple switches, order of operations is as follows: -i -l -u -q -r -g -m -1. If an alignment is excluded by a preceding operation, it will be ignored by the succeeding operations.

        An important distinction between the -g option and the -1 and -m options is that -g requires the alignments to be mutually consistent in their order, while the -1 and -m options are not required to be mutually consistent and therefore tolerate translocations, inversions, etc.

        In general cases, the -m option is the best choice, however -1 can be handy for applications such as SNP finding which require a 1-to-1 mapping. 

        Finally, for mapping query contigs, or sequencing reads, to a reference genome, use -q.
    ]]></help>
    <citations>
        <citation type="bibtex">
            @misc{githubmummer,
            author = {Art Delcher, Stefan Kurtz, Adam Phillippy, Steven Salzberg},
            year = {2012},
            title = {mummer4},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/mummer4/mummer},
        }</citation>
    </citations>
</tool>